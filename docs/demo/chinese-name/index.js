var $chineseCharacters,$sancai,$81,$api_url="/demo/chinese-name/",$quality=75,$pickWords=[],$sancaiKey=["水","木","木","火","火","土","土","金","金","水"];function renderResult(e,t){$("."+e+"DrawCount").html(t),$("."+e+"5e").html(get5EColor(t%10)),$("."+e+"GoodOrbad").html($81[t].text),$("."+e+"Content").html(get81Content(t))}function get81Content(e){return $81[e].content}function getWordsOf5E(e){var t=[];if(e)for(var a=0;a<e.length;a++)for(var r in $pickWords)-1!=$pickWords[r].chars.indexOf(e[a])&&t.push(e[a]+get5EColor($pickWords[r].fiveEle));return t.join(", ")}function get5EColor(e){switch(e){case"木":case 1:case 2:return"<b style='color:green'>(木)</b>";case"火":case 3:case 4:return"<b style='color:red'>(火)</b>";case"土":case 5:case 6:return"<b style='color:brown'>(土)</b>";case"金":case 7:case 8:return"<b style='color:gold'>(金)</b>";case"水":case 0:case 9:return"<b style='color:blue'>(水)</b>"}}function getCombinations(e){var t=0,a=0;for(r in $chineseCharacters)if(-1!=$chineseCharacters[r].chars.indexOf(e)){a=((t=$chineseCharacters[r].draw)+1)%10,$(".familyName").html(e+get5EColor($chineseCharacters[r].fiveEle)),$(".familyNameDrawCount").html(t);break}var r,o=[];for(r in $sancai)if(r[0]==$sancaiKey[a]&&8<=$sancai[r].value)for(var i=t+1;i<=t+26;i++)if($sancaiKey[i%10]==r[1])for(var n,s,c=i-t,l=1+c;l<=26+c;l++)$sancaiKey[l%10]==r[2]&&(s=$81[t+1].value,(s=((s=(s=(s+=$81[t+c].value)+$81[c+(n=l-c)].value)+$81[1+n].value)+$81[t+c+n].value)*2)>=Math.min(Math.max(0,$quality),100))&&o.push({key:r,value:s,top:t,middle:c,bottom:n});return o}$(function(){$(this).on("change","#familyName",function(){if(""!=$(this).val()){$("#combination").find("option").remove(),$("#combination").append("<option value=''>請選擇</option>");var e=getCombinations($("#familyName").val());for(key in e.sort(function(e,t){if(e.value<t.value)return 1;if(!(e.value>t.value)){if(e.middle>t.middle)return 1;if(!(e.middle<t.middle)){if(e.bottom>t.bottom)return 1;e.bottom,t.bottom}}return-1}),e){var t=e[key],a="適合筆畫: "+t.top+", "+t.middle+", "+t.bottom+" (綜合分數:"+t.value+")";$("#combination").append($("<option></option>").attr("value",JSON.stringify(t)).text(a))}}}),$(this).on("change","#combination",function(){if(""!=$(this).val()){var e,i=$.parseJSON($(this).val());for(e in $pickWords=[],$chineseCharacters)$chineseCharacters[e].draw!=i.middle&&$chineseCharacters[e].draw!=i.bottom||$pickWords.push($chineseCharacters[e]);$(".sancai").html(i.key),$(".sancaiGoodOrbad").html($sancai[i.key].text),$(".sancaiContent").html($sancai[i.key].content),renderResult("top",i.top+1),renderResult("middle",i.top+i.middle),renderResult("bottom",i.middle+i.bottom),renderResult("out",i.bottom+1),renderResult("total",i.top+i.middle+i.bottom),$.get($api_url+$("#zodiac").val()+".json",function(e){$(".giveNameDrawCount1").html(i.middle),$(".giveName1_better").html(getWordsOf5E(e.better["_"+i.middle])),$(".giveName1_worse").html(getWordsOf5E(e.worse["_"+i.middle]));var t="";for(r in $chineseCharacters)if($chineseCharacters[r].draw===i.middle)for(var a=(o=$chineseCharacters[r].chars).length;a--;)e.better["_"+i.middle]&&-1!=e.better["_"+i.middle].indexOf(o[a])||e.worse["_"+i.middle]&&-1!=e.worse["_"+i.middle].indexOf(o[a])||(t+=o[a]);$(".giveName1_normal").html(getWordsOf5E(t)),$(".giveNameDrawCount2").html(i.bottom),$(".giveName2_better").html(getWordsOf5E(e.better["_"+i.bottom])),$(".giveName2_worse").html(getWordsOf5E(e.worse["_"+i.bottom]));var r,t="";for(r in $chineseCharacters)if($chineseCharacters[r].draw===i.bottom)for(var o,a=(o=$chineseCharacters[r].chars).length;a--;)e.better["_"+i.bottom]&&-1!=e.better["_"+i.bottom].indexOf(o[a])||e.worse["_"+i.bottom]&&-1!=e.worse["_"+i.bottom].indexOf(o[a])||(t+=o[a]);$(".giveName2_normal").html(getWordsOf5E(t))})}}),$(this).on("change","#zodiac",function(){$("#familyName").trigger("change")}),$(this).on("click",".btnDisplay",function(){"顯示"==$(this).text()?($(this).text("隱藏"),$(this).closest("tr").find("span").removeClass("hide")):($(this).text("顯示"),$(this).closest("tr").find("span").addClass("hide"))}),$.get($api_url+"ChineseCharacters.json",function(e){$chineseCharacters=e}),$.get($api_url+"Sancai.json",function(e){$sancai=e}),$.get($api_url+"EightyOne.json",function(e){for(var t in $81={},e)$81[e[t].draw]=e[t]})});